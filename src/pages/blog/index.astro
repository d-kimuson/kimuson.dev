---
import Layout from '../../layouts/layout.astro';
import { BlogListPage } from '~/features/blog/components/blog-list-page'
import { buildInternalArticle } from '~/domain-object/article/internal-article'
import { fetchExternalArticles } from '~/config/external-articles'
import { fetchAllRssPosts } from '~/repositories/external-articles/fetch-rss-items'
import type { Article } from '~/domain-object/article';

const internalArticles: Article[] = await Astro.glob('./**/*.md')
  .then((rawArticles) =>
    rawArticles.map((article) => {
      const url = article.url
      if (url === undefined) throw new Error('UnExpected.')

      return buildInternalArticle(article.frontmatter, url)
    })
  )
const externalArticles = await fetchExternalArticles()
const rssArticles = await fetchAllRssPosts()
const articles = internalArticles.concat(externalArticles).concat(rssArticles)

---

<Layout title="Welcome to Astro.">
  <BlogListPage client:load articles={articles} />
</Layout>

<style>
</style>
